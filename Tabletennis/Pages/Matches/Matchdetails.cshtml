@page "{id:int}"
@model Tabletennis.Pages.Matches.MatchDetailsModel
@{
    ViewData["Title"] = "Match Details";
}
<h2>Match Details</h2>

<div class="card my-4 shadow-sm">
    <div class="card-header text-white" style="background-color: #c4553e;">
        Match on @Model.Match.MatchDate.ToString("yyyy-MM-dd")
    </div>
    <div class="card-body">
        <h5 class="card-title">Players</h5>
        <ul class="list-group list-group-flush mb-3">
            @foreach (var player in Model.Match.Players)
            {
                <li class="list-group-item">
                    <strong>@player.FullName</strong> — @player.Email, @player.Gender
                </li>
            }
        </ul>

        <h5 class="card-title">Sets</h5>
        <table class="table table-bordered">
            <thead class="table-light">
                <tr>
                    <th>Set #</th>
                    <th>Team 1 Score</th>
                    <th>Team 2 Score</th>
                    <th>Winner</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var set in Model.Match.Sets.OrderBy(s => s.SetNumber))
                {
                    var winningPlayers = Model.Match.Players
                    .Where(p => p.TeamNumber == set.WinnerId)
                    .Select(p => p.FullName)
                    .ToList();

                    var winnerNames = string.Join(" & ", winningPlayers);

                    <tr>
                        <td>@set.SetNumber</td>
                        <td>@set.Team1Score</td>
                        <td>@set.Team2Score</td>
                        <td>@(string.IsNullOrWhiteSpace(winnerNames) ? "N/A" : winnerNames)</td>
                    </tr>
                }
            </tbody>
        </table>

        <p class="mt-3"><strong>Match Winner:</strong> @Model.Match.Winner</p>
    </div>
</div>

<div class="d-flex justify-content-center mb-3">
    <a asp-page="/Matches/MatchHistory" class="btn btn-secondary" style="background-color: #c4553e; color: white;">
        ← Back to Match History
    </a>
</div>