@page
@model Tabletennis.Pages.Matches.MatchHistoryModel
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@using Services.Infrastructure
@{
    ViewData["Title"] = "Match History";
}
<div class="container mt-4">
    <h2>Match History</h2>

    <form method="get" class="mb-3 d-flex gap-2 align-items-center">
        <input type="text" name="Query" class="form-control" placeholder="Search by player..."
               value="@Model.Query" />

        <input type="date" name="SelectedDate" class="form-control"
               value="@(Model.SelectedDate?.ToString("yyyy-MM-dd"))" />

        <button type="submit" class="btn btn-primary" style="background-color: #c4553e;">
            <i class="bi bi-search"></i> <!-- Bootstrap search icon -->
        </button>
    </form>

    @if (Model.Matches.Results.Any())
    {
        <table class="table table-striped">
            <thead>
                <tr>
                    <th class="custom-thead">Match ID</th>
                    <th class="custom-thead">Player 1</th>
                    <th class ="custom-thead">Player 2</th>
                    <th class="custom-thead">Winner</th>
                    <th class="custom-thead">Date</th>
                    <th class="custom-thead">Sets</th>
                    <th class="custom-thead">Action</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var match in Model.Matches.Results)
                {
                    <tr>
                        <td>@match.MatchId</td>
                        <td>@match.Player1FullName</td>
                        <td>@match.Player2FullName</td>
                        <td>@match.Winner</td>
                        <td>@match.StartDate.ToString("yyyy-MM-dd")</td>
                        <td>
                            @if (match.Sets != null && match.Sets.Any())
                            {
                                @string.Join(", ", match.Sets.Select(s => $"{s.Team1Score}-{s.Team2Score}"))
                            }
                            else
                            {
                                <em>No Sets</em>
                            }
                        </td>
                        <td>
                            <a class="btn btn-sm btn-outline-secondary" asp-page="/Matches/MatchDetails" asp-route-id="@match.MatchId">Details</a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>

        <!-- Pagination -->
        <div class="pagination-container d-flex justify-content-center mt-4">
            <div class="custom-pagination d-flex align-items-center gap-4">
                @if (Model.Matches.CurrentPage > 1)
                {
                    <a class="custom-page-button" style="background-color: #c4553e;color:white;"
                       asp-route-pageNumber="@(Model.Matches.CurrentPage - 1)"
                       asp-route-query="@Model.Query"
                       asp-route-date="@(Model.SelectedDate?.ToString("yyyy-MM-dd"))">
                        Previous
                    </a>
                }
                else
                {
                    <span class="custom-page-button disabled">Previous</span>
                }

                <span class="pagination-info">Page @Model.Matches.CurrentPage of @Model.Matches.PageCount</span>

                @if (Model.Matches.CurrentPage < Model.Matches.PageCount)
                {
                    <a class="custom-page-button" style="background-color: #c4553e;color:white;"
                       asp-route-pageNumber="@(Model.Matches.CurrentPage + 1)"
                       asp-route-query="@Model.Query"
                       asp-route-date="@(Model.SelectedDate?.ToString("yyyy-MM-dd"))">
                        Next
                    </a>
                }
                else
                {
                    <span class="custom-page-button disabled">Next</span>
                }
            </div>
        </div>

    }
    else
    {
        <div class="alert alert-info">No matches found.</div>
    }
</div>